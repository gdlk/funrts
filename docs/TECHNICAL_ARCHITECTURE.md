# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –¢—Ä–∏ –†–∞—Å—ã
## –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞:** 14.12.2024
**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ ECS –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## 1. –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–µ–∫–∞

### 1.1 –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å—Ç–µ–∫ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–î–≤–∏–∂–æ–∫: Godot 4.x**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏ open-source** ‚Äî –Ω–µ—Ç –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã—Ö –æ—Ç—á–∏—Å–ª–µ–Ω–∏–π
- ‚úÖ **–û—Ç–ª–∏—á–Ω–∞—è 2D –ø–æ–¥–¥–µ—Ä–∂–∫–∞** ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è 2D –∏–≥—Ä
- ‚úÖ **–õ–µ–≥–∫–∏–π –≤–µ—Å** ‚Äî –±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∫–æ–º–ø–∏–ª—è—Ü–∏—è
- ‚úÖ **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** ‚Äî Windows, macOS, Linux, Web
- ‚úÖ **GDScript** ‚Äî –ø—Ä–æ—Å—Ç–æ–π —è–∑—ã–∫, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ Python
- ‚úÖ **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä** ‚Äî –≤—Å–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ** ‚Äî –º–Ω–æ–≥–æ —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–Ω–¥–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–Ω–æ–≥–∏–º–∏ —É—Å–ø–µ—à–Ω—ã–º–∏ –∏–Ω–¥–∏-–∏–≥—Ä–∞–º–∏

**–Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:**
- **GDScript** (–æ—Å–Ω–æ–≤–Ω–æ–π) ‚Äî –¥–ª—è –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
- **C#** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- **Aseprite** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∏–∫—Å–µ–ª—å-–∞—Ä—Ç —Å–ø—Ä–∞–π—Ç–æ–≤
- **Tiled** ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç (—ç–∫—Å–ø–æ—Ä—Ç –≤ Godot)
- **GIMP/Krita** ‚Äî –≥—Ä–∞—Ñ–∏–∫–∞
- **Audacity** ‚Äî –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- **Git** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π

---

### 1.2 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–µ–∫ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

**–î–≤–∏–∂–æ–∫: Unity 2D**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ **–ú–æ—â–Ω—ã–π –∏ –∑—Ä–µ–ª—ã–π** ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è
- ‚úÖ **–ë–æ–ª—å—à–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ** ‚Äî –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ **Asset Store** ‚Äî –≥–æ—Ç–æ–≤—ã–µ –∞—Å—Å–µ—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- ‚úÖ **C#** ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —è–∑—ã–∫
- ‚ö†Ô∏è **–õ–∏—Ü–µ–Ω–∑–∏—è** ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ $200k –¥–æ—Ö–æ–¥–∞
- ‚ö†Ô∏è **–¢—è–∂–µ–ª–µ–µ Godot** ‚Äî –±–æ–ª—å—à–µ —Ä–∞–∑–º–µ—Ä –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å Unity:**
- –ï—Å–ª–∏ —É–∂–µ –∑–Ω–∞–µ—Ç–µ C# –∏ Unity
- –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
- –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –≥–æ—Ç–æ–≤—ã–µ –∞—Å—Å–µ—Ç—ã –∏–∑ Asset Store

---

### 1.3 –í–µ–±-–≤–µ—Ä—Å–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)

**–°—Ç–µ–∫: TypeScript + PixiJS/Phaser**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** ‚Äî –∏–≥—Ä–∞—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ **–ë—ã—Å—Ç—Ä–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ** ‚Äî –Ω–µ –Ω—É–∂–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- ‚úÖ **TypeScript** ‚Äî —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript
- ‚ö†Ô∏è **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
- ‚ö†Ô∏è **–ë–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã** ‚Äî –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–µ —Å –Ω—É–ª—è

**–ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å –≤–µ–±:**
- –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ itch.io —Ä–µ–ª–∏–∑
- –ï—Å–ª–∏ –µ—Å—Ç—å –æ–ø—ã—Ç –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–≥—Ä—ã (Godot + ECS)

### 2.0 –ì–∏–±—Ä–∏–¥–Ω–∞—è ECS –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–í–ê–ñ–ù–û:** –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥** - Godot Node –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ + ECS –¥–ª—è –ª–æ–≥–∏–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–æ—â—å Godot (—Ñ–∏–∑–∏–∫–∞, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥, UI)
- ‚úÖ –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ECS (3-5x –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è 200+ —é–Ω–∏—Ç–æ–≤)
- ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑ —Ä–∏—Å–∫–∞
- ‚úÖ –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ECS:**
- [`docs/ECS_ARCHITECTURE.md`](ECS_ARCHITECTURE.md) - –ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [`docs/ECS_MIGRATION_GUIDE.md`](ECS_MIGRATION_GUIDE.md) - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- [`docs/ECS_IMPLEMENTATION_PLAN.md`](ECS_IMPLEMENTATION_PLAN.md) - –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- [`scripts/ecs/README.md`](../scripts/ecs/README.md) - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
funrts/
‚îú‚îÄ‚îÄ project.godot
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ sprites/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lizards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ canids/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rus/
‚îÇ   ‚îú‚îÄ‚îÄ audio/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ music/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sfx/
‚îÇ   ‚îú‚îÄ‚îÄ fonts/
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îú‚îÄ‚îÄ scenes/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Main.tscn
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Main.gd
‚îÇ   ‚îú‚îÄ‚îÄ game/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Game.tscn
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Game.gd
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MainMenu.tscn
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HUD.tscn
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BuildMenu.tscn
‚îÇ   ‚îú‚îÄ‚îÄ units/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BaseUnit.tscn
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LizardUnit.tscn
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CanidUnit.tscn
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RusUnit.tscn
‚îÇ   ‚îú‚îÄ‚îÄ buildings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BaseBuilding.tscn
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [—Ä–∞—Å–æ–≤—ã–µ –ø–æ—Å—Ç—Ä–æ–π–∫–∏]
‚îÇ   ‚îî‚îÄ‚îÄ world/
‚îÇ       ‚îú‚îÄ‚îÄ Tile.tscn
‚îÇ       ‚îú‚îÄ‚îÄ Map.tscn
‚îÇ       ‚îî‚îÄ‚îÄ MapGenerator.gd
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ ecs/                          # ‚≠ê –ù–û–í–ê–Ø ECS –ê–†–•–ò–¢–ï–ö–¢–£–†–ê
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ECSWorld.gd              # –ú–µ–Ω–µ–¥–∂–µ—Ä ECS (–∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Entity.gd                # –ë–∞–∑–æ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Component.gd             # –ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ System.gd                # –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EntityNode.gd            # –°–≤—è–∑—å Node ‚Üî ECS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UnitNode.gd              # –ì–∏–±—Ä–∏–¥–Ω—ã–π —é–Ω–∏—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BuildingNode.gd          # –ì–∏–±—Ä–∏–¥–Ω–æ–µ –∑–¥–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/              # 15 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TransformComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HealthComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VelocityComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NeedsComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SkillsComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StatsComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PathComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BuildingComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductionComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WorkersComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RaceComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LizardBioComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CanidPackComponent.gd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RusMechanicalComponent.gd
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ systems/                 # 4 ECS —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ECSNeedsSystem.gd
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ECSMovementSystem.gd
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ECSProductionSystem.gd
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ECSAISystem.gd
‚îÇ   ‚îú‚îÄ‚îÄ autoload/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameManager.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ResourceManager.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EventBus.gd
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SaveSystem.gd
‚îÇ   ‚îú‚îÄ‚îÄ systems/                      # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PathfindingSystem.gd     # (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ECS)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductionSystem.gd      # (—É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç, –∑–∞–º–µ–Ω—è–µ—Ç—Å—è ECS)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NeedsSystem.gd           # (—É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç, –∑–∞–º–µ–Ω—è–µ—Ç—Å—è ECS)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CombatSystem.gd
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UnitData.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BuildingData.gd
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ResourceData.gd
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ Constants.gd
‚îÇ       ‚îî‚îÄ‚îÄ Helpers.gd
‚îî‚îÄ‚îÄ data/
    ‚îú‚îÄ‚îÄ units/
    ‚îú‚îÄ‚îÄ buildings/
    ‚îú‚îÄ‚îÄ resources/
    ‚îî‚îÄ‚îÄ events/
```

---
### 2.2 ECS –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ù–æ–≤–æ–µ!)

#### 2.2.0 –û–±–∑–æ—Ä –≥–∏–±—Ä–∏–¥–Ω–æ–π ECS

**Entity-Component-System** - —ç—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω, –≥–¥–µ:
- **Entity** - –ø—Ä–æ—Å—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID, —Å–≤—è–∑—ã–≤–∞—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Component** - –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ª–æ–≥–∏–∫–∏ (–∑–¥–æ—Ä–æ–≤—å–µ, –ø–æ–∑–∏—Ü–∏—è, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏)
- **System** - –ª–æ–≥–∏–∫–∞ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)

**–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤ –ø—Ä–æ–µ–∫—Ç–µ:**
```
UnitNode (CharacterBody2D)  ‚Üê‚Üí  ECS Entity
     ‚Üì                              ‚Üì
–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è                   –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
–§–∏–∑–∏–∫–∞                         (–¥–∞–Ω–Ω—ã–µ)
Input                              ‚Üì
     ‚Üì                          –°–∏—Å—Ç–µ–º—ã
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è  ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  (–ª–æ–≥–∏–∫–∞)
```

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —é–Ω–∏—Ç–∞ —Å ECS:**
```gdscript
# –°–æ–∑–¥–∞–Ω–∏–µ —é–Ω–∏—Ç–∞
var unit = UnitNode.new()
unit.global_position = Vector2(100, 100)
unit.unit_race = "lizard"
add_child(unit)

# Entity –∏ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ _ready()!

# –†–∞–±–æ—Ç–∞ —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
var health = ecs_world.get_component(unit.entity_id, "res://scripts/ecs/components/HealthComponent.gd")
health.take_damage(10)

var needs = ecs_world.get_component(unit.entity_id, "res://scripts/ecs/components/NeedsComponent.gd")
print("Mood: ", needs.get_mood())
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ECS –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞:**
- üöÄ **3-5x –±—ã—Å—Ç—Ä–µ–µ** –¥–ª—è 200+ —é–Ω–∏—Ç–æ–≤ (—Å–º. –±–µ–Ω—á–º–∞—Ä–∫–∏ –≤ ECS_MIGRATION_GUIDE.md)
- üé® **–ì–∏–±–∫–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- üîß **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å–∏—Å—Ç–µ–º—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã
- üìä **Cache-friendly** - –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ –≤ –ø–∞–º—è—Ç–∏, –ª—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU cache
- üîÑ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ECS:**
- [`docs/ECS_ARCHITECTURE.md`](ECS_ARCHITECTURE.md) - –ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- [`docs/ECS_MIGRATION_GUIDE.md`](ECS_MIGRATION_GUIDE.md) - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- [`docs/ECS_IMPLEMENTATION_PLAN.md`](ECS_IMPLEMENTATION_PLAN.md) - –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- [`docs/ECS_NEXT_STEPS.md`](ECS_NEXT_STEPS.md) - —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- [`scripts/ecs/README.md`](../scripts/ecs/README.md) - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å ECS:**
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (ECSWorld, Entity, Component, System)
- ‚úÖ 15 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Transform, Health, Needs, Skills –∏ –¥—Ä.)
- ‚úÖ 4 —Å–∏—Å—Ç–µ–º—ã (Needs, Movement, Production, AI)
- ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–µ –∫–ª–∞—Å—Å—ã (UnitNode, BuildingNode)
- üöß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —é–Ω–∏—Ç–æ–≤

---


### 2.2 –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

#### 2.2.1 GameManager (Autoload)

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏–≥—Ä—ã, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

```gdscript
# scripts/autoload/GameManager.gd
extends Node

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
var current_race: String = ""
var game_speed: float = 1.0
var is_paused: bool = false
var game_time: float = 0.0

# –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—ã
var resource_manager: ResourceManager
var event_bus: EventBus

func _ready():
    resource_manager = get_node("/root/ResourceManager")
    event_bus = get_node("/root/EventBus")

func _process(delta):
    if not is_paused:
        game_time += delta * game_speed
        
func pause_game():
    is_paused = true
    get_tree().paused = true
    
func resume_game():
    is_paused = false
    get_tree().paused = false
    
func set_game_speed(speed: float):
    game_speed = clamp(speed, 0.5, 3.0)
```

---

#### 2.2.2 ResourceManager (Autoload)

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤ –∏–≥—Ä–µ.

```gdscript
# scripts/autoload/ResourceManager.gd
extends Node

# –°–ª–æ–≤–∞—Ä—å —Ä–µ—Å—É—Ä—Å–æ–≤: {"wood": 100, "stone": 50, ...}
var resources: Dictionary = {}

signal resource_changed(resource_name: String, amount: int)

func add_resource(resource_name: String, amount: int):
    if not resources.has(resource_name):
        resources[resource_name] = 0
    resources[resource_name] += amount
    emit_signal("resource_changed", resource_name, resources[resource_name])

func remove_resource(resource_name: String, amount: int) -> bool:
    if not has_resource(resource_name, amount):
        return false
    resources[resource_name] -= amount
    emit_signal("resource_changed", resource_name, resources[resource_name])
    return true

func has_resource(resource_name: String, amount: int) -> bool:
    return resources.get(resource_name, 0) >= amount

func get_resource(resource_name: String) -> int:
    return resources.get(resource_name, 0)
```

---

#### 2.2.3 EventBus (Autoload)

–°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

```gdscript
# scripts/autoload/EventBus.gd
extends Node

# –°–∏–≥–Ω–∞–ª—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
signal unit_selected(unit)
signal unit_died(unit)
signal building_constructed(building)
signal building_destroyed(building)
signal resource_depleted(resource_node)
signal enemy_raid_started()
signal day_passed()
signal season_changed(season)

# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

---

#### 2.2.4 PathfindingSystem

A* –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏.

```gdscript
# scripts/systems/PathfindingSystem.gd
extends Node

class_name PathfindingSystem

var astar: AStar2D = AStar2D.new()
var map_size: Vector2
var tile_size: int = 32

func initialize(map_width: int, map_height: int):
    map_size = Vector2(map_width, map_height)
    _build_astar_grid()

func _build_astar_grid():
    # –°–æ–∑–¥–∞–µ–º —É–∑–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–π–ª–∞
    for x in range(map_size.x):
        for y in range(map_size.y):
            var id = _get_point_id(x, y)
            astar.add_point(id, Vector2(x, y))
    
    # –°–æ–µ–¥–∏–Ω—è–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ —É–∑–ª—ã
    for x in range(map_size.x):
        for y in range(map_size.y):
            var id = _get_point_id(x, y)
            # 4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥–æ–Ω–∞–ª–∏)
            if x > 0:
                astar.connect_points(id, _get_point_id(x-1, y))
            if x < map_size.x - 1:
                astar.connect_points(id, _get_point_id(x+1, y))
            if y > 0:
                astar.connect_points(id, _get_point_id(x, y-1))
            if y < map_size.y - 1:
                astar.connect_points(id, _get_point_id(x, y+1))

func find_path(from: Vector2, to: Vector2) -> Array:
    var from_id = _get_point_id(int(from.x), int(from.y))
    var to_id = _get_point_id(int(to.x), int(to.y))
    return astar.get_point_path(from_id, to_id)

func _get_point_id(x: int, y: int) -> int:
    return x + y * int(map_size.x)

func set_point_disabled(x: int, y: int, disabled: bool):
    var id = _get_point_id(x, y)
    astar.set_point_disabled(id, disabled)
```

---

#### 2.2.5 NeedsSystem

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π —é–Ω–∏—Ç–æ–≤.

```gdscript
# scripts/systems/NeedsSystem.gd
extends Node

class_name NeedsSystem

const NEED_DECAY_RATE = {
    "hunger": 1.0,      # –ì–æ–ª–æ–¥ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1 –≤ —Å–µ–∫—É–Ω–¥—É
    "rest": 0.5,        # –£—Å—Ç–∞–ª–æ—Å—Ç—å –Ω–∞ 0.5 –≤ —Å–µ–∫—É–Ω–¥—É
    "comfort": 0.2,     # –ö–æ–º—Ñ–æ—Ä—Ç –Ω–∞ 0.2 –≤ —Å–µ–∫—É–Ω–¥—É
    "social": 0.3,      # –°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ 0.3 –≤ —Å–µ–∫—É–Ω–¥—É
}

func update_needs(unit, delta: float):
    for need in unit.needs:
        var decay = NEED_DECAY_RATE.get(need, 0.1)
        unit.needs[need] = max(0, unit.needs[need] - decay * delta)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π
    update_mood(unit)

func update_mood(unit):
    var total_needs = 0.0
    var need_count = unit.needs.size()
    
    for need_value in unit.needs.values():
        total_needs += need_value
    
    var average_need = total_needs / need_count if need_count > 0 else 50.0
    
    # –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ—Ç -100 –¥–æ +100
    unit.mood = (average_need - 50) * 2
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
    apply_mood_effects(unit)

func apply_mood_effects(unit):
    if unit.mood > 50:
        unit.work_speed_modifier = 1.2
    elif unit.mood < -50:
        unit.work_speed_modifier = 0.8
    else:
        unit.work_speed_modifier = 1.0
```

---

### 2.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —é–Ω–∏—Ç–æ–≤

#### –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å Unit

```gdscript
# scenes/units/BaseUnit.gd
extends CharacterBody2D

class_name BaseUnit

# –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
var unit_name: String = ""
var race: String = ""
var health: float = 100.0
var max_health: float = 100.0

# –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
var strength: int = 5
var agility: int = 5
var intelligence: int = 5
var endurance: int = 5

# –ù–∞–≤—ã–∫–∏ (0-100)
var skills: Dictionary = {
    "mining": 0,
    "building": 0,
    "combat": 0,
    "crafting": 0
}

# –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (0-100)
var needs: Dictionary = {
    "hunger": 100,
    "rest": 100,
    "comfort": 50,
    "social": 50
}

# –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (-100 –¥–æ +100)
var mood: float = 0.0

# –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
var work_speed_modifier: float = 1.0

# –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
enum State { IDLE, MOVING, WORKING, FIGHTING, SLEEPING, EATING }
var current_state: State = State.IDLE

# –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞
var current_task = null

# –ü—É—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è
var path: Array = []
var path_index: int = 0

signal task_completed()
signal died()

func _ready():
    add_to_group("units")
    unit_name = _generate_name()

func _process(delta):
    match current_state:
        State.IDLE:
            _process_idle(delta)
        State.MOVING:
            _process_moving(delta)
        State.WORKING:
            _process_working(delta)
        State.FIGHTING:
            _process_fighting(delta)
        State.SLEEPING:
            _process_sleeping(delta)
        State.EATING:
            _process_eating(delta)

func _process_idle(delta):
    # –ò—â–µ–º –∑–∞–¥–∞—á—É –∏–ª–∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
    if needs["hunger"] < 30:
        find_food()
    elif needs["rest"] < 30:
        find_bed()
    else:
        request_task()

func _process_moving(delta):
    if path.is_empty():
        current_state = State.IDLE
        return
    
    var target = path[path_index]
    var direction = (target - global_position).normalized()
    velocity = direction * 100 * work_speed_modifier
    move_and_slide()
    
    if global_position.distance_to(target) < 5:
        path_index += 1
        if path_index >= path.size():
            path.clear()
            current_state = State.IDLE
            if current_task:
                start_working()

func move_to(target_position: Vector2):
    var pathfinding = get_node("/root/PathfindingSystem")
    path = pathfinding.find_path(global_position, target_position)
    path_index = 0
    current_state = State.MOVING

func take_damage(amount: float):
    health -= amount
    if health <= 0:
        die()

func die():
    emit_signal("died")
    queue_free()

func _generate_name() -> String:
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–º–µ–Ω–∏
    var names = ["–ì—Ä–æ–∫", "–ó–∞—Ä–∞", "–¢–æ—Ä–Ω", "–õ–∏—Ä–∞", "–ö—Ä–æ–∫"]
    return names[randi() % names.size()]

# –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö
func _process_working(delta):
    pass

func _process_fighting(delta):
    pass

func _process_sleeping(delta):
    needs["rest"] = min(100, needs["rest"] + 20 * delta)
    if needs["rest"] >= 100:
        current_state = State.IDLE

func _process_eating(delta):
    needs["hunger"] = min(100, needs["hunger"] + 30 * delta)
    if needs["hunger"] >= 100:
        current_state = State.IDLE

func find_food():
    # –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –µ–¥—ã
    pass

func find_bed():
    # –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –∫—Ä–æ–≤–∞—Ç–∏
    pass

func request_task():
    # –ó–∞–ø—Ä–æ—Å –∑–∞–¥–∞—á–∏ —É —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏
    pass

func start_working():
    current_state = State.WORKING
```

---

### 2.4 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç—Ä–æ–µ–∫

#### –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å Building

```gdscript
# scenes/buildings/BaseBuilding.gd
extends StaticBody2D

class_name BaseBuilding

# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
var building_name: String = ""
var building_type: String = ""
var race: String = ""

# –°–æ—Å—Ç–æ—è–Ω–∏–µ
enum State { BLUEPRINT, CONSTRUCTING, OPERATIONAL, DAMAGED, DESTROYED }
var current_state: State = State.BLUEPRINT

# –ó–¥–æ—Ä–æ–≤—å–µ
var health: float = 100.0
var max_health: float = 100.0

# –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
var construction_progress: float = 0.0
var required_resources: Dictionary = {}
var delivered_resources: Dictionary = {}

# –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
var production_queue: Array = []
var production_progress: float = 0.0
var production_speed: float = 1.0

# –†–∞–±–æ—á–∏–µ
var assigned_workers: Array = []
var max_workers: int = 1

signal construction_completed()
signal production_completed(item)
signal destroyed()

func _ready():
    add_to_group("buildings")

func _process(delta):
    match current_state:
        State.CONSTRUCTING:
            _process_construction(delta)
        State.OPERATIONAL:
            _process_operation(delta)
        State.DAMAGED:
            _process_damaged(delta)

func _process_construction(delta):
    if _has_all_resources():
        construction_progress += delta * 10 * assigned_workers.size()
        if construction_progress >= 100:
            complete_construction()

func _process_operation(delta):
    if not production_queue.is_empty():
        production_progress += delta * production_speed * assigned_workers.size()
        if production_progress >= 100:
            complete_production()

func _process_damaged(delta):
    # –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–≥–æ –∑–¥–∞–Ω–∏—è
    pass

func deliver_resource(resource_name: String, amount: int):
    if not delivered_resources.has(resource_name):
        delivered_resources[resource_name] = 0
    delivered_resources[resource_name] += amount

func _has_all_resources() -> bool:
    for resource in required_resources:
        if delivered_resources.get(resource, 0) < required_resources[resource]:
            return false
    return true

func complete_construction():
    current_state = State.OPERATIONAL
    construction_progress = 100
    emit_signal("construction_completed")

func add_to_production_queue(item):
    production_queue.append(item)

func complete_production():
    var item = production_queue.pop_front()
    production_progress = 0
    emit_signal("production_completed", item)

func assign_worker(worker):
    if assigned_workers.size() < max_workers:
        assigned_workers.append(worker)

func remove_worker(worker):
    assigned_workers.erase(worker)

func take_damage(amount: float):
    health -= amount
    if health <= 0:
        destroy()
    elif health < max_health * 0.5:
        current_state = State.DAMAGED

func destroy():
    current_state = State.DESTROYED
    emit_signal("destroyed")
    queue_free()
```

---

### 2.5 –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ä—Ç—ã –∏ —Ç–∞–π–ª–æ–≤

```gdscript
# scenes/world/Map.gd
extends Node2D

class_name Map

var map_width: int = 128
var map_height: int = 128
var tile_size: int = 32

# –î–≤—É–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤ —Ç–∞–π–ª–æ–≤
var tiles: Array = []

# TileMap –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
@onready var tilemap: TileMap = $TileMap

func _ready():
    generate_map()

func generate_map():
    tiles.clear()
    
    # –°–æ–∑–¥–∞–µ–º –¥–≤—É–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤
    for x in range(map_width):
        tiles.append([])
        for y in range(map_height):
            var tile = create_tile(x, y)
            tiles[x].append(tile)
            tilemap.set_cell(0, Vector2i(x, y), 0, tile.terrain_type)

func create_tile(x: int, y: int) -> Dictionary:
    # –ü—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å —à—É–º–æ–º –ü–µ—Ä–ª–∏–Ω–∞
    var noise = FastNoiseLite.new()
    noise.seed = randi()
    var value = noise.get_noise_2d(x, y)
    
    var tile = {
        "position": Vector2(x, y),
        "terrain_type": _get_terrain_from_noise(value),
        "resources": [],
        "walkable": true,
        "building": null
    }
    
    return tile

func _get_terrain_from_noise(value: float) -> int:
    if value < -0.3:
        return 0  # –í–æ–¥–∞
    elif value < 0.0:
        return 1  # –†–∞–≤–Ω–∏–Ω–∞
    elif value < 0.3:
        return 2  # –õ–µ—Å
    else:
        return 3  # –ì–æ—Ä—ã

func get_tile(x: int, y: int):
    if x >= 0 and x < map_width and y >= 0 and y < map_height:
        return tiles[x][y]
    return null

func is_walkable(x: int, y: int) -> bool:
    var tile = get_tile(x, y)
    return tile != null and tile.walkable and tile.building == null
```

---

## 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 3.1 –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**1. –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ (Spatial Partitioning)**
```gdscript
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –≥—Ä—É–ø–ø Godot
# –†–∞–∑–¥–µ–ª—è–µ–º –∫–∞—Ä—Ç—É –Ω–∞ —á–∞–Ω–∫–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
class_name ChunkManager

var chunk_size: int = 32
var chunks: Dictionary = {}

func get_chunk_key(position: Vector2) -> Vector2i:
    return Vector2i(
        int(position.x / chunk_size),
        int(position.y / chunk_size)
    )

func add_to_chunk(entity, position: Vector2):
    var key = get_chunk_key(position)
    if not chunks.has(key):
        chunks[key] = []
    chunks[key].append(entity)

func get_nearby_entities(position: Vector2, radius: int) -> Array:
    var result = []
    var center_chunk = get_chunk_key(position)
    var chunk_radius = int(radius / chunk_size) + 1
    
    for x in range(-chunk_radius, chunk_radius + 1):
        for y in range(-chunk_radius, chunk_radius + 1):
            var key = center_chunk + Vector2i(x, y)
            if chunks.has(key):
                result.append_array(chunks[key])
    
    return result
```

**2. Object Pooling**
```gdscript
# –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö
class_name ObjectPool

var pool: Array = []
var scene: PackedScene

func _init(scene_path: String, initial_size: int = 10):
    scene = load(scene_path)
    for i in range(initial_size):
        var obj = scene.instantiate()
        obj.visible = false
        pool.append(obj)

func get_object():
    if pool.is_empty():
        return scene.instantiate()
    var obj = pool.pop_back()
    obj.visible = true
    return obj

func return_object(obj):
    obj.visible = false
    pool.append(obj)
```

**3. –õ–µ–Ω–∏–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è**
```gdscript
# –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã
func _process(delta):
    var camera_rect = get_viewport_rect()
    for unit in get_tree().get_nodes_in_group("units"):
        if camera_rect.has_point(unit.global_position):
            unit.update_logic(delta)
        else:
            unit.update_minimal(delta)  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

**4. –ú—É–ª—å—Ç–∏–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
```gdscript
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
var thread: Thread

func generate_map_async():
    thread = Thread.new()
    thread.start(_generate_map_thread)

func _generate_map_thread():
    # –¢—è–∂–µ–ª—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
    var map_data = _generate_large_map()
    call_deferred("_on_map_generated", map_data)

func _on_map_generated(map_data):
    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    apply_map_data(map_data)
    thread.wait_to_finish()
```

---

### 3.2 –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∞–π–ª–µ—Ä Godot:**
- Debugger ‚Üí Profiler
- Monitors ‚Üí Performance

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- FPS (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 60+)
- Process Time (< 16ms –¥–ª—è 60 FPS)
- Physics Time (< 5ms)
- Memory Usage (< 500MB –¥–ª—è —Å—Ä–µ–¥–Ω–µ–π –∏–≥—Ä—ã)

---

## 4. –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π

### 4.1 –§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

```gdscript
# scripts/autoload/SaveSystem.gd
extends Node

const SAVE_PATH = "user://savegame.json"

func save_game():
    var save_data = {
        "version": "1.0",
        "timestamp": Time.get_unix_time_from_system(),
        "game_time": GameManager.game_time,
        "race": GameManager.current_race,
        "resources": ResourceManager.resources,
        "units": _serialize_units(),
        "buildings": _serialize_buildings(),
        "map": _serialize_map()
    }
    
    var file = FileAccess.open(SAVE_PATH, FileAccess.WRITE)
    file.store_string(JSON.stringify(save_data, "\t"))
    file.close()

func load_game() -> bool:
    if not FileAccess.file_exists(SAVE_PATH):
        return false
    
    var file = FileAccess.open(SAVE_PATH, FileAccess.READ)
    var json_string = file.get_as_text()
    file.close()
    
    var json = JSON.new()
    var parse_result = json.parse(json_string)
    if parse_result != OK:
        return false
    
    var save_data = json.data
    _deserialize_game(save_data)
    return true

func _serialize_units() -> Array:
    var units_data = []
    for unit in get_tree().get_nodes_in_group("units"):
        units_data.append({
            "name": unit.unit_name,
            "race": unit.race,
            "position": [unit.global_position.x, unit.global_position.y],
            "health": unit.health,
            "needs": unit.needs,
            "skills": unit.skills,
            "mood": unit.mood
        })
    return units_data

func _serialize_buildings() -> Array:
    var buildings_data = []
    for building in get_tree().get_nodes_in_group("buildings"):
        buildings_data.append({
            "type": building.building_type,
            "position": [building.global_position.x, building.global_position.y],
            "state": building.current_state,
            "health": building.health
        })
    return buildings_data

func _serialize_map() -> Dictionary:
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ç–∞–π–ª—ã
    return {
        "seed": 12345,  # –î–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        "modified_tiles": []
    }

func _deserialize_game(data: Dictionary):
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    GameManager.game_time = data.game_time
    GameManager.current_race = data.race
    ResourceManager.resources = data.resources
    # ... –∏ —Ç.–¥.
```

---

## 5. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### 5.1 –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–æ–≤

```gdscript
# scripts/ModLoader.gd
extends Node

const MODS_PATH = "user://mods/"

func load_mods():
    var dir = DirAccess.open(MODS_PATH)
    if dir:
        dir.list_dir_begin()
        var file_name = dir.get_next()
        while file_name != "":
            if dir.current_is_dir() and file_name != "." and file_name != "..":
                load_mod(file_name)
            file_name = dir.get_next()

func load_mod(mod_name: String):
    var mod_path = MODS_PATH + mod_name + "/mod.gd"
    if FileAccess.file_exists(mod_path):
        var mod_script = load(mod_path)
        var mod_instance = mod_script.new()
        mod_instance.initialize()
```

### 5.2 –°–∏—Å—Ç–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (Data-Driven Design)

–í—Å–µ –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON/YAML —Ñ–∞–π–ª–∞—Ö:

```json
// data/units/lizard_worker.json
{
    "id": "lizard_worker",
    "name": "–Ø—â–µ—Ä-—Ä–∞–±–æ—á–∏–π",
    "race": "lizards",
    "base_stats": {
        "health": 100,
        "strength": 5,
        "agility": 4,
        "intelligence": 3,
        "endurance": 6
    },
    "skills": {
        "mining": 10,
        "building": 15,
        "combat": 5,
        "crafting": 8
    },
    "sprite":