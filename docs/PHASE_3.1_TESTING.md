# Инструкции по тестированию Фазы 3.1

**Дата:** 02.12.2024  
**Статус:** Готово к тестированию

---

## Что было реализовано

### 1. Визуальная система карты
- ✅ Создан базовый тайлсет (4 типа местности)
- ✅ Обновлен Map.gd с визуальным рендерингом через TileMap
- ✅ Процедурная генерация карты с шумом Перлина
- ✅ Система слоев (местность, ресурсы, оверлей)

### 2. Система камеры
- ✅ CameraController с полным управлением
- ✅ Перемещение: WASD, стрелки, edge scrolling
- ✅ Зум: колесико мыши
- ✅ Перетаскивание: средняя кнопка мыши
- ✅ Ограничение границами карты

### 3. Оптимизация
- ✅ ChunkManager для управления чанками
- ✅ VisibilityManager для culling невидимых объектов
- ✅ Настройки рендеринга в project.godot

### 4. Система юнитов
- ✅ Визуализация пути движения (Line2D)
- ✅ Избегание столкновений между юнитами
- ✅ Плавное движение с замедлением
- ✅ Индикаторы выделения

### 5. Система выделения
- ✅ SelectionManager для управления выделением
- ✅ Выделение рамкой (box selection)
- ✅ Множественное выделение (Shift)
- ✅ Визуальные индикаторы

---

## Необходимые шаги для запуска

### 1. Создание TileSet ресурса

В Godot Editor:

1. Откройте `assets/tiles/terrain_tileset.png`
2. В инспекторе Import установите:
   - Filter: Nearest
   - Repeat: Disabled
3. Нажмите Reimport

4. Создайте новый TileSet:
   - Правый клик в FileSystem → New Resource → TileSet
   - Сохраните как `assets/tiles/terrain_tileset.tres`

5. Откройте TileSet:
   - Добавьте новый Atlas Source
   - Выберите `terrain_tileset.png` как текстуру
   - Установите Texture Region Size: 32x32
   - Создайте тайлы для координат (0,0), (1,0), (2,0), (3,0)

### 2. Настройка сцены Map

1. Откройте `scenes/world/Map.tscn`
2. Убедитесь, что есть узел TileMap как дочерний узел Map
3. В TileMap установите:
   - Tile Set: `res://assets/tiles/terrain_tileset.tres`
   - Cell Size: 32x32

### 3. Настройка сцены Game

1. Откройте `scenes/game/Game.tscn`
2. Добавьте Camera2D узел:
   - Прикрепите скрипт `scripts/systems/CameraController.gd`
   - Добавьте в группу "camera"
   - Установите Enabled: true

### 4. Тестирование базовых функций

#### Тест 1: Визуализация карты
```
Запустите игру (F5)
Ожидаемый результат:
- Видна процедурно сгенерированная карта
- Разные цвета для воды, равнин, лесов и гор
- Карта заполняет экран
```

#### Тест 2: Управление камерой
```
Действия:
1. Нажмите WASD или стрелки
2. Подвиньте мышь к краям экрана
3. Покрутите колесико мыши
4. Зажмите среднюю кнопку и перетащите

Ожидаемый результат:
- Камера плавно перемещается
- Зум работает корректно
- Камера не выходит за границы карты
```

#### Тест 3: Создание и движение юнитов
```
В Game.gd добавьте тестовый код в _ready():

func _ready():
    # Создаем тестовых юнитов
    for i in range(10):
        var unit = preload("res://scenes/units/LizardUnit.tscn").instantiate()
        unit.global_position = Vector2(
            randf_range(100, 500),
            randf_range(100, 500)
        )
        add_child(unit)

Действия:
1. Запустите игру
2. Кликните ЛКМ по карте

Ожидаемый результат:
- Юниты появляются на карте
- При клике юниты двигаются к точке
- Видна зеленая линия пути
- Юниты избегают столкновений
```

#### Тест 4: Выделение юнитов
```
Действия:
1. Зажмите ЛКМ и протяните рамку через юнитов
2. Отпустите ЛКМ
3. Зажмите Shift и выделите еще юнитов
4. Кликните ПКМ по карте

Ожидаемый результат:
- Появляется зеленая рамка выделения
- Выделенные юниты имеют зеленый круг
- Shift добавляет к выделению
- ПКМ перемещает всех выделенных юнитов
```

---

## Известные ограничения

1. **TileSet нужно создать вручную** - автоматическое создание через код не поддерживается
2. **Нет правого клика для перемещения** - нужно добавить обработку в SelectionManager
3. **Простая графика** - используются цветные квадраты вместо спрайтов

---

## Следующие шаги

После успешного тестирования:

1. Добавить обработку ПКМ для перемещения юнитов
2. Создать более детальные спрайты для тайлов
3. Добавить анимации для юнитов
4. Реализовать туман войны
5. Добавить миникарту

---

## Метрики производительности

Целевые показатели:
- **FPS:** 60 при 50+ юнитах
- **Время генерации карты:** < 1 секунда
- **Задержка выделения:** < 16ms

Для проверки производительности:
1. В Godot включите Debug → Visible FPS
2. Создайте 50+ юнитов
3. Проверьте FPS при движении камеры

---

## Troubleshooting

### Проблема: Карта не отображается
**Решение:** Проверьте, что TileSet правильно настроен и привязан к TileMap

### Проблема: Камера не двигается
**Решение:** Убедитесь, что Camera2D имеет скрипт CameraController и добавлен в группу "camera"

### Проблема: Юниты не выделяются
**Решение:** Проверьте, что SelectionManager добавлен в autoload в project.godot

### Проблема: Низкий FPS
**Решение:** 
- Уменьшите размер карты в Constants.gd
- Проверьте, что VisibilityManager работает
- Уменьшите количество юнитов